# Telegram AI UserBot

**Telegram UserBot на Python + Pyrogram**, который работает от вашего личного аккаунта и автоматически отвечает людям с помощью мощных LLM.

### Возможности
- Автоответы через OpenRouter (DeepSeek, GPT-4o, Claude 3, Mistral и др.)
- Умная буферизация сообщений — бот не спамит, а отвечает одним осмысленным сообщением
- Режимы общения: `normal`, `friendly`, `funny`, `rude`
- Проактивные сообщения (сам напишет, если человек долго молчит)
- Полное управление через «Избранное» (Saved Messages)
- Хранение пользователей, истории и настроек в SQLite (SQLAlchemy)

---

## Структура проекта

```plaintext
TG_AI_USER_BOT/
├── app/
│   ├── __init__.py
│   ├── client.py              # Pyrogram Client
│   ├── handlers.py            # Обработка входящих сообщений и команд
│   ├── message_buffer.py      # Умная буферизация быстрых сообщений
│   ├── openrouter.py          # Работа с OpenRouter API
│   ├── proactive_messages.py  # Проактивные сообщения
│   ├── prompts.py             # Персоны и режимы общения
│   └── utils.py               # Вспомогательные функции
│
├── database/
│   ├── __init__.py
│   ├── models.py              # SQLAlchemy модели (User, History и др.)
│   ├── crud.py                # CRUD-операции
│   └── session.py             # Сессия и инициализация БД
│
├── config.py                  # Конфигурация проекта
├── run.py                     # Точка входа — запуск бота
├── requirements.txt
├── .env                       # Токены и секреты (не коммитится)
└── tg_ai_user_bot.db          # SQLite база (создаётся автоматически)
```

---

## Быстрый старт

1. **Установите зависимости**
   ```bash
   pip install -r requirements.txt
   ```

2. **Создайте файл `.env` в корне проекта**
   ```env
   API_ID=ваш_api_id
   API_HASH=ваш_api_hash
   OPENROUTER_API_KEY=sk-or-...
   ```

   API_ID и API_HASH получаем на https://my.telegram.org

3. **Запустите бота**
   ```bash
   python run.py
   ```
   При первом запуске придёт код в Telegram для авторизации.

---

## Как работает умный ответ

Бот не отвечает на каждое сообщение мгновенно, а:
1. Собирает все быстрые сообщения в буфер
2. Ждёт паузу 5–10 секунд
3. Отправляет в LLM один большой контекст
4. Присылает один естественный и связный ответ

→ Переписка выглядит максимально по-человечески.

---

## Команды (пишите в «Избранное»)

| Команда                        | Описание                                      |
|--------------------------------|-----------------------------------------------|
| `.add 123456789`               | Добавить пользователя в список общения        |
| `.mode 123456789 funny`        | Установить режим общения                      |
| `.on` / `.off`                 | Включить/выключить автоответы глобально       |
| `.proactive on` / `.proactive off` | Вкл/выкл проактивные сообщения           |

### Доступные режимы
- `normal` — нейтральный  
- `friendly` — дружелюбный  
- `funny` — с юмором  
- `rude` — дерзкий (осторожно!)

---

## База данных

SQLite + SQLAlchemy. Хранит:
- Пользователей и их настройки
- Историю переписки
- Режимы общения
- Флаги активности
- Корзины покупок (если будете расширять)

---

## Вклад

Любые Pull Request'ы и идеи очень приветствуются  
Проект специально сделан чистым и легко расширяемым.

## Лицензия

MIT

---

Если понравилось — ставьте звёздочку!  
Вопросы, идеи, баги — пишите в Issues.
